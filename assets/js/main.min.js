const categoryMenu=document.getElementById("menu-category"),categories=document.querySelectorAll(".category-filter"),footer=document.getElementsByClassName("footer")[0];function toggleFooter(){footer.style.display="none"!==footer.style.display?"none":"block"}const hideCards=function(){cards.forEach(e=>{e.style.display="none"})};function showCategories(){toggleFooter(),uncheckAll(),sortMenu.style.display="none",categoryMenu.style.display="flex"===categoryMenu.style.display?"none":"flex",cards.forEach(e=>{e.style.display="none"}),currentOrder=numberAsc,sort()}const show=function(e){filterGraph(e),cards.filter(t=>t.dataset.category===e).forEach(e=>{e.style.display="none"===e.style.display?"inline":"none"})};function showAll(){footer.style.display="block",categoryMenu.style.display="none",cards.forEach(e=>{currentOrder=numberAsc,sort(),e.style.display="flex"})}const uncheckAll=function(){categories.forEach((function(e){e.checked=!1})),graphFilterList=[]},width=window.innerWidth||900,height=900;let graph,store,graphFilterList=[],svg=d3.select("#graph-kanji").append("svg").attr("width",width).attr("height",900),tooltip=d3.select("#graph-kanji").append("div").attr("class","tooltip").text("default text to be overridden"),color=d3.scaleOrdinal(d3.schemeCategory20),node=svg.append("g").attr("class","nodes").selectAll("g"),simulation=d3.forceSimulation().force("center",d3.forceCenter().x(width/2).y(450)).force("link",d3.forceLink()).force("charge",d3.forceManyBodyReuse().strength(.001)).force("collide",d3.forceCollide().strength(1).radius(size(13)).iterations(8)).force("x",d3.forceX().strength(width<700?180/width:.05)).force("y",d3.forceY().strength(width<700?.16*width/900:.05));function updateSimulation(){node=node.data(graph.nodes,(function(e){return e.id})),node.exit().remove();let e=node.enter().append("g").attr("class","node").on("mouseover",e=>tooltip.style("visibility","visible").text(kanjiLabel(e))).on("mousemove",()=>tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")).on("mouseout",()=>tooltip.style("visibility","hidden"));e.append("circle").attr("class",(function(e){return e.group})).attr("r",size(12)).call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended)),e.append("text").attr("class","kanji").attr("x",-8).attr("y",6).text(e=>e.name),e.append("title").text(e=>e.name);node=node.merge(e),simulation.nodes(graph.nodes).on("tick",()=>ticked(node)),simulation.force("link").links(graph.links),simulation.alpha(.3).alphaTarget(0).restart()}function filterGraph(e){graphFilterList.includes(e)?graphFilterList.splice(graphFilterList.indexOf(e),1):graphFilterList.push(e),filterSimulation(),updateSimulation()}function filterSimulation(){store.nodes.forEach((function(e){e.isFilteredOut&&!graphFilterList.includes(e.group)&&(e.isFilteredOut=!1,graph.nodes.push(Object.assign({},{},e))),e.isFilteredOut=graphFilterList.includes(e.group)})),graph.nodes=store.nodes.filter(e=>!e.isFilteredOut)}d3.json(jsonUrl,(function(e,t){if(e)throw e;graph=t,store=Object.assign({},{},t),updateSimulation()}));let frequencySize=e=>e.frequency/60,numberSize=e=>e.number,sizeFunction=frequencySize;function size(e){return function(t){return e+sizeFunction(t)}}function kanjiLabel(e){return e.name.concat(" - ",e.reading," - ",e.meaning)}function dragstarted(e){d3.event.active||simulation.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function dragged(e){e.fx=d3.event.x,e.fy=d3.event.y}function dragended(e){d3.event.active||simulation.alphaTarget(0),e.fx=null,e.fy=null}function ticked(e){e.attr("transform",e=>"translate("+e.x+","+e.y+")")}function lazyloadFallback(e){const t=delayedLoadingOnEvents(!1,e);document.addEventListener("scroll",t),window.addEventListener("resize",t),window.addEventListener("orientationchange",t)}function delayedLoadingOnEvents(e,t){const n=function(){!1===e&&(e=!0,setTimeout((function(){t.forEach((function(e){e.getBoundingClientRect().top<=window.innerHeight&&e.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(e).display&&(e.src=e.dataset.src,e.srcset=e.dataset.srcset,e.classList.remove("lazy"),0===(t=t.filter((function(t){return t!==e}))).length&&(document.removeEventListener("scroll",n),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)))})),e=!1}),200))};return n}document.addEventListener("DOMContentLoaded",(function(){let e=[].slice.call(document.querySelectorAll("img.lazy"));if("IntersectionObserver"in window){let t=new IntersectionObserver((function(e,n){e.forEach((function(e){if(e.isIntersecting){let n=e.target;n.src=n.dataset.src,n.srcset=n.dataset.srcset,n.classList.remove("lazy"),t.unobserve(n)}}))}));e.forEach((function(e){t.observe(e)}))}else lazyloadFallback(e)})),function(){"use strict";document.querySelectorAll(".modal-button").forEach((function(e){e.onclick=function(){console.log("modal");var t=e.getAttribute("data-modal");document.getElementById(t).style.display="block"}})),document.querySelectorAll(".close").forEach((function(e){e.onclick=function(){console.log("close"),function(e,t){for(var n,r=(e.document||e.ownerDocument).querySelectorAll(t);e;){for(n=r.length-1;n>=0;){if(r.item(n)===e)return e;n-=1}e=e.parentElement}return e}(e,".modal").style.display="none"}})),window.onclick=function(e){"modal"===e.target.className&&(console.log("other"),e.target.style.display="none")}}();const cards=[...document.getElementsByClassName("card")],sortMenu=document.getElementById("menu-sort"),number=document.getElementById("Number-sort"),frequency=document.getElementById("Frequency-sort"),category=document.getElementById("Category-sort"),reading=document.getElementById("Reading-sort"),frequencyAsc=(e,t)=>e.dataset.frequency-t.dataset.frequency,frequencyDsc=(e,t)=>t.dataset.frequency-e.dataset.frequency,numberAsc=(e,t)=>e.dataset.value-t.dataset.value,numberDsc=(e,t)=>t.dataset.value-e.dataset.value,categoryAsc=(e,t)=>e.dataset.category.localeCompare(t.dataset.category),categoryDsc=(e,t)=>t.dataset.category.localeCompare(e.dataset.category),readingAsc=(e,t)=>e.dataset.reading.localeCompare(t.dataset.reading),readingDsc=(e,t)=>t.dataset.reading.localeCompare(e.dataset.reading);let currentOrder=numberAsc;number.addEventListener("click",()=>{currentOrder=setOrder(currentOrder,numberDsc,numberAsc),sort()}),frequency.addEventListener("click",()=>{currentOrder=setOrder(currentOrder,frequencyAsc,frequencyDsc),sort()}),category.addEventListener("click",()=>{currentOrder=setOrder(currentOrder,categoryDsc,categoryAsc),sort()}),reading.addEventListener("click",()=>{currentOrder=setOrder(currentOrder,readingDsc,readingAsc),sort()});const setOrder=function(e,t,n){return e===n?t:n},sort=function(){cards.sort(currentOrder).forEach((e,t)=>{e.style.order=t.toString()})};function showSorts(){categoryMenu.style.display="none",sortMenu.style.display="flex"===sortMenu.style.display?"none":"flex"}